<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Diffie-Hellman Key Exchange - J-PAKE over TLS</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../../tls/tls.html"><strong aria-hidden="true">2.</strong> Introduction of TLS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../tls/handshake.html"><strong aria-hidden="true">2.1.</strong> Handshake</a></li><li class="chapter-item expanded "><a href="../../tls/cert_auth.html"><strong aria-hidden="true">2.2.</strong> Certificate Authentication</a></li></ol></li><li class="chapter-item expanded "><a href="../../pake/pake.html"><strong aria-hidden="true">3.</strong> PAKE: Password authenticated Key Exchange</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../pake/security_requirements.html"><strong aria-hidden="true">3.1.</strong> Security Requirements</a></li><li class="chapter-item expanded "><a href="../../pake/two_stages.html"><strong aria-hidden="true">3.2.</strong> General Two-Stage Framework</a></li><li class="chapter-item expanded "><a href="../../pake/balanced/balanced_pake.html"><strong aria-hidden="true">3.3.</strong> Balanced PAKE</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../pake/balanced/dh-eke.html"><strong aria-hidden="true">3.3.1.</strong> DH-EKE: Diffie-Hellman Encrypted key exchange</a></li><li class="chapter-item expanded "><a href="../../pake/balanced/speke.html"><strong aria-hidden="true">3.3.2.</strong> SPEKE: Simple Password Exponential Key Exchange</a></li></ol></li><li class="chapter-item expanded "><a href="../../pake/augmented/augmented_pake.html"><strong aria-hidden="true">3.4.</strong> Augmented PAKE</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../pake/augmented/srp.html"><strong aria-hidden="true">3.4.1.</strong> SRP: Secure Remote Password protocol</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../pake/balanced/jpake/intro.html"><strong aria-hidden="true">4.</strong> J-PAKE: Password Authenticated Key Exchange by Juggling</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../pake/balanced/jpake/jpake.html"><strong aria-hidden="true">4.1.</strong> J-PAKE protocol</a></li><li class="chapter-item expanded "><a href="../../pake/balanced/jpake/security.html"><strong aria-hidden="true">4.2.</strong> Security</a></li><li class="chapter-item expanded "><a href="../../pake/balanced/jpake/comparison.html"><strong aria-hidden="true">4.3.</strong> Comparison</a></li></ol></li><li class="chapter-item expanded "><a href="../../pake/balanced/jpake/jpake_over_tls.html"><strong aria-hidden="true">5.</strong> J-PAKE over TLS</a></li><li class="chapter-item expanded "><a href="../../discussion.html"><strong aria-hidden="true">6.</strong> Discussion</a></li><li class="chapter-item expanded "><a href="../../appendix/index.html"><strong aria-hidden="true">7.</strong> Appendix</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../appendix/hash.html"><strong aria-hidden="true">7.1.</strong> Hash function</a></li><li class="chapter-item expanded "><a href="../../appendix/modular_arithmetic.html"><strong aria-hidden="true">7.2.</strong> Modular Arithmetic</a></li><li class="chapter-item expanded "><a href="../../appendix/gcd.html"><strong aria-hidden="true">7.3.</strong> GCD: Greatest Common Divisors</a></li><li class="chapter-item expanded "><a href="../../appendix/group_theory.html"><strong aria-hidden="true">7.4.</strong> Group Theory</a></li><li class="chapter-item expanded "><a href="../../appendix/trapdoor_function.html"><strong aria-hidden="true">7.5.</strong> Trapdoor Function</a></li><li class="chapter-item expanded "><a href="../../appendix/dh/dh.html" class="active"><strong aria-hidden="true">7.6.</strong> Diffie-Hellman Key Exchange</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../appendix/dh/dh_multiple_parties.html"><strong aria-hidden="true">7.6.1.</strong> Diffie-Hellman with Multiple Parties</a></li><li class="chapter-item expanded "><a href="../../appendix/dh/assumptions.html"><strong aria-hidden="true">7.6.2.</strong> Diffie-Hellman Assumptions</a></li></ol></li><li class="chapter-item expanded "><a href="../../appendix/zkp/zkp.html"><strong aria-hidden="true">7.7.</strong> Zero-Knowledge Proof</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../appendix/zkp/schnorr_signature.html"><strong aria-hidden="true">7.7.1.</strong> Schnorr Signature</a></li></ol></li><li class="chapter-item expanded "><a href="../../appendix/ecc.html"><strong aria-hidden="true">7.8.</strong> Elliptic Curve Cryptography</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">J-PAKE over TLS</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="diffie-hellman-key-exchange"><a class="header" href="#diffie-hellman-key-exchange">Diffie-Hellman Key Exchange</a></h1>
<p>Make two parties share secret messages.</p>
<h2 id="problem"><a class="header" href="#problem">Problem</a></h2>
<p>How do you shared secret messages with someone who don't have a shared key?
If they have the secret shared key, then they can use key crypto to
encrypt/decrypt messages.
Is it possible to build a secret shared key between two parties
if they already have a insecure channel?</p>
<h3 id="alice-bob-and-eve"><a class="header" href="#alice-bob-and-eve">Alice, Bob, and Eve</a></h3>
<p>Assume that there are Alice, Bob, and Eve.
Alice and Bob want to talk to each other privately,
but Eve can eavesdrop this channel.
The problem is: Can Alice and Bob build a secure channel between them?</p>
<p><img src="eve-the-eavesdropper.png" alt="alice_bob_eve" title="Alice, Bob and Eve" /></p>
<h4 id="passive-attacker-eve-a-eavesdropper"><a class="header" href="#passive-attacker-eve-a-eavesdropper">Passive Attacker: Eve, a eavesdropper</a></h4>
<p>Eve can see all messages on the channel,
but she can't modify them.</p>
<h2 id="concept-diffie-hellman-in-colors"><a class="header" href="#concept-diffie-hellman-in-colors">Concept: Diffie-Hellman in colors</a></h2>
<p><img src="DH-color-0.png" alt="DH-color0" title="DH-color-0" /></p>
<p>It's better to use the color-mixing to explain the <em>Diffie-Hellman</em>.
At first, Alice and Bob agree to use a color <em>Yellow</em>
as their initial color. This is not secret,
so Eve can also know they will use yellow as
their initial color.</p>
<p><img src="DH-color-1.png" alt="DH-color1" title="DH-color-1" /></p>
<p>Next, Alice and Bob will randomly choose a secret color
that won't tell anyone as their <strong>private key</strong>.
Suppose Alice and Bob choose <em>Red</em> and <em>Cyan</em> respectively,
then they will use their own secret color to mix with
the initial color <em>Yellow</em>.
After mixing the secret color with the initial color,
Alice will get color <em>Dark-Orange</em>,
and Bob will get color <em>Light-Green</em> as their <strong>public key</strong>.</p>
<p>Next, Alice and Bob will give each other their mixing color.
Eve can eavesdrop the conversation between Alice and Bob,
so she can know their mixing color too.</p>
<p>After Alice receives Bob's mixing color: <em>Light-Green</em>,
she can make two copies of it and mixing these two with her
own secret color: <em>Red</em> to get a final mixing color.</p>
<p>Similarly, Bob can produce a final color by mixing his
own secret color with the two copies of received mixing color from Alice.</p>
<p>Surprisingly, Alice and Bob will generate the <strong>exactly same</strong> final color
by the above step! They will both get <em>Olive Green</em>!
The final color is the <strong>shared secret key</strong> between the Alice and Bob.</p>
<p>After they both generate the same <strong>shared secret key</strong>,
they can use it to encrypt or decrypt their messages.</p>
<h3 id="summary"><a class="header" href="#summary">Summary</a></h3>
<p>At first, Alice and Bob choose their own secret color:</p>
<ul>
<li>Alice: Red</li>
<li>Bob: Cyan</li>
</ul>
<p>Then they mix their secret color with the initial color:</p>
<ul>
<li>Alice: Yellow + Red = Dark-Orange</li>
<li>Bob: Yellow + Cyan = Light-Green</li>
</ul>
<p>Next, they give each other their mixing color, and then
they both use the received mixing color
to produce the final color:</p>
<ul>
<li>Alice: Red + Light-Green + Light-Green = Olive Green</li>
<li>Bob: Cyan + Dark-Orange + Dark-Orange = Olive Green</li>
</ul>
<h3 id="can-we-choose-other-colors"><a class="header" href="#can-we-choose-other-colors">Can we choose other colors?</a></h3>
<p>This game works even Alice and Bob choose other secret colors.
Why not try your own to test and see the results?</p>
<h4 id="try-you-own"><a class="header" href="#try-you-own">Try you own</a></h4>
<p>You can play this game on online color mixing tool, like <a href="http://trycolors.com/" title="Online Color Mixing tool">TryColors</a>.
If you want to re-produce our example, the used colors are:</p>
<table><thead><tr><th>color</th><th>code</th></tr></thead><tbody>
<tr><td>Yellow</td><td>#FFFF00</td></tr>
<tr><td>Red</td><td>#FF0000</td></tr>
<tr><td>Cyan</td><td>#00FFFF</td></tr>
<tr><td>Dark-Orange</td><td>#FF8000</td></tr>
<tr><td>Light-Green</td><td>#80FF80</td></tr>
<tr><td>Olive Green</td><td>#AAAA55</td></tr>
</tbody></table>
<p>You can play our example online <a href="http://trycolors.com/?try=1&amp;ffff00=0&amp;ff0000=0&amp;00ffff=0&amp;ff8000=0&amp;80ff80=0&amp;aaaa55=0" title="Our example">here</a>.
We already put all colors on it.</p>
<p>For those who is curious about the information of the produced colors,
you can just enter the color code <a href="http://www.htmlcsscolor.com/" title="Get Color Info">here</a> to get the color's name.</p>
<h3 id="can-eve-produce-the-final-color"><a class="header" href="#can-eve-produce-the-final-color">Can Eve produce the final color?</a></h3>
<p>Actually, Eve can produce the final color in this example
if Eve know how Alice and Bob will mix those colors.
However, if Alice and Bob finish their private conversation
by using the shared secret key to encrypt/decrypt messages
before Eve cracks the shared secret key, then the conversation
can still be safe.</p>
<p>In real world, the shared key is not easy to crack as our example here.
This will be well-explained after
introducing the standard <em>Diffie-Hellman</em> below.</p>
<h2 id="diffie-hellman-in-math"><a class="header" href="#diffie-hellman-in-math">Diffie-Hellman in Math</a></h2>
<p><img src="DH-math.png" alt="DH-math" title="DH-math" /></p>
<p>The initial setting between Alice and Bob from
the original implementation of the protocol is
a multiplicative group \( G \) of integers modulo \( p \) with generator \( g \),
where \( p \) is prime, and \( g \) is a primitive root modulo p.</p>
<p>The protocol is pretty simple.
First, both Alice and Bob agree to use one set of \( g, p \).
Then, just like the color example, Alice and Bob will respectively choose a
random integer \( a, b \), where \( a, b \in [1, p-1] \),as their <strong>private key</strong>.</p>
<p>Next, Alice and Bob will compute their <strong>public key</strong> \( A \), \( B \):</p>
<p>\begin{aligned}
A = g^a \bmod p \\
\\
B = g^b \bmod p
\end{aligned}</p>
<p>and send them to each other.
That is, Alice will receive \( B \), and Bob will receive \( A \).</p>
<p>After exchanging the <strong>public key</strong>,
Alice and Bob can use the received number to produce a <strong>shared secret key</strong>.</p>
<p>Let the shared secret key of Alice and Bob are \( Secret_A \) and \( Secret_B \),
and they are defined by:</p>
<p>\begin{aligned}
Secret_A &amp;= B^a \bmod p \\
&amp;= (g^b \bmod p)^a \bmod p \\
&amp;= g^{ab} \bmod p \\
\\
Secret_B &amp;= A^b \bmod p \\
&amp;= (g^a \bmod p)^b \bmod p \\
&amp;= g^{ab} \bmod p
\end{aligned}</p>
<p>(For those who are not familiar with the above operations,
please read <a href="../modular_arithmetic.html" title="Modular Arithmetic">modular arithmetic</a> in the appendix first.)</p>
<p>Thus,</p>
<p>$$
Secret_A = Secret_B
$$</p>
<p>Surprisingly, again, Alice and Bob will generate
the <strong>exactly same</strong> shared secret key.
They can use this key to encrypt the sent messages
or decrypt the received messages.</p>
<p>Notice that \( a, b, A, B, Secret_A, Secret_B \) are all located in
range \( [1, p-1] \) because the operation \( \bmod p \).</p>
<h3 id="examples"><a class="header" href="#examples">Examples</a></h3>
<p>Let \( G = { 1, 2, 3, 4 } \) with prime \( p = 5 \) and generator \( g = 2 \).
It's easy to check the group \( G \) by:</p>
<p>\begin{aligned}
2^1 \bmod 5 &amp;= 2 \\
2^2 \bmod 5 &amp;= 2 \cdot 2 \bmod 5 \\
&amp;= 4 \\
2^3 \bmod 5 &amp;= 4 \cdot 2 \bmod 5 \\
&amp;= 3 \\
2^4 \bmod 5 &amp;= 3 \cdot 2 \bmod 5 \\
&amp;= 1 \\
2^5 \bmod 5 &amp;= 1 \cdot 2 \bmod 5 \\
&amp;= 2
\end{aligned}</p>
<p>The \( g = 2 \) indeed can generate all elements \( { 1, 2, 3, 4 } \)
and the generated element will go back to the first at the \( p \) times.</p>
<p>After checking our settings, we start to play the <em>Diffie-Hellman</em>.
Suppose Alice picks \( a = 3 \) and Bob picks \( b = 2 \),
then</p>
<p>\begin{aligned}
A &amp;= g^a \bmod p = 2^3 \bmod 5 = 3 \\
\\
B &amp;= g^b \bmod p = 2^2 \bmod 5 = 4
\end{aligned}</p>
<p>Next, Alice will send \( A \) to Bob, and Bob will send \( B \) to Alice.
Then Alice and Bob can compute the shared secret key after receiving
the other's public key.</p>
<p>\begin{aligned}
Secret_A &amp;= B^a \bmod p = 4^3 \bmod 5 = 4 \\
\\
Secret_B &amp;= A^b \bmod p = 3^2 \bmod 5 = 4
\end{aligned}</p>
<p>It's obvious that \( Secret_A = Secret_B \) is a symmetric key pair,
so Alice and Bob can apply some symmetric key cryptography algorithm
such as <em>AES</em>, <em>DES</em>, to encrypt and decrypt their messages.</p>
<p>The following table shows what Alice, Bob, and Eve know about the numbers
for producing the shared secret key:</p>
<table><thead><tr><th>Step</th><th>Alice</th><th>Eve</th><th>Bob</th></tr></thead><tbody>
<tr><td>0</td><td>g = 2, p = 5</td><td>g = 2, p = 5</td><td>g = 2, p = 5</td></tr>
<tr><td>1</td><td>a = 3</td><td></td><td>b = 2</td></tr>
<tr><td>2</td><td>A = 3</td><td>A = 3, B = 4</td><td>B = 4</td></tr>
<tr><td>3</td><td>Secret<sub>A</sub> = 4</td><td></td><td>Secret<sub>B</sub> = 4</td></tr>
</tbody></table>
<p>To get familiar with the <em>Diffie-Hellman</em> protocol,
you can use the <a href="../group_theory.html" title="Group Theory">example groups in appendix</a> to play it.</p>
<h3 id="one-round-trip-implementation"><a class="header" href="#one-round-trip-implementation">One Round-Trip Implementation</a></h3>
<p>The whole Diffie-Hellman can be actually done in one round-trip communication:
<img src="one-roundtrip-Diffie-Hellman.png" alt="one-roundtrip-DH" title="one-roundtrip-DH" /></p>
<h3 id="can-eve-compute-the-shared-secret-key"><a class="header" href="#can-eve-compute-the-shared-secret-key">Can Eve compute the shared secret key?</a></h3>
<p>The answer depends on whether \( G \) and \( g \) are chosen properly.
In particular, the bigger of the size(or the order) of the group \( G \) is,
the better the security between Alice and Bob is.</p>
<p>When the size of \( G \) is small, like the above example,
it's easy to crack the <em>secret key</em> from the <em>public key</em>.</p>
<p>For instance, Eve can list all power-value pairs upon she knows \( g \) and \( p \).
The power and value is actually the secret key and the public key.</p>
<table><thead><tr><th>power(secret key)</th><th>value(public key)</th></tr></thead><tbody>
<tr><td>1</td><td>2</td></tr>
<tr><td>2</td><td>4</td></tr>
<tr><td>3</td><td>3</td></tr>
<tr><td>4</td><td>1</td></tr>
</tbody></table>
<p>With the above table, she can easily get the correct secret keys
after receiving the public keys.
When Eve receives \( A = 3, B = 4 \),
she can look up the table to find the \( a = 3, b = 2 \).</p>
<p>However, if the size of group is very large,
then it will be very hard to list all the numbers
and search the matched secret keys.
This is actually the base of our network security today.
The function \( f(x) = g^x \bmod p \) is one of the <strong>trapdoor</strong> functions,
or <strong>one-way function</strong> functions.
It's easy to use \( x \) to compute \( f(x) \),
yet difficult to find its inverse function \( f^{-1}(f(x)) \) to get \( x \).
The inverse function here is called <em>discrete logarithm problem</em>.
It is considered to be computationally intractable.
Currently there is no efficient algorithm to compute
the discrete logarithms in general.</p>
<p>Thus, when \( p \) is a very large number(the size of \( G \) will be very large),
then Eve is currently impossible to eavesdrop the messages between Alice and Bob.</p>
<p>(See more of trapdoor function <a href="../trapdoor_function.html" title="Trapdoor Function">here</a>.)</p>
<h3 id="generalization-to-finite-cyclic-groups"><a class="header" href="#generalization-to-finite-cyclic-groups">Generalization to Finite Cyclic Groups</a></h3>
<p><em>Diffie-Hellman</em> protocol is actually can be generalize to finite cyclic groups,
instead of specifying with the multiplicative group of integers modulo \( p \).
In practice, <em>Elliptic Curve Diffie–Hellman</em> protocol is usually a better choice.
It can achieve same security with less computation.</p>
<ol>
<li>Alice and Bob agree to use a finite cyclic group \( G \) of order \( n \)
and a generator \( g \). The operation is defined: \( g^2 = g \centerdot g \),
where \( \centerdot \) is the operator of the group.</li>
<li>Alice randomly picks a number \( a \), \( 1 \leq a &lt; n \),
and send \( g^a \) to Bob.</li>
<li>Similarly, Bob picks a random number \( b \), \( 1 \leq b &lt; n \),
and send \( g^b \) to Alice.</li>
<li>Alice computes \( (g^b)^a = g^{ab} \)</li>
<li>Bob computes \( (g^a)^b = g^{ab} \)</li>
</ol>
<p>The \( f(x) = g^x \) must be a one-way function and
there should be no efficient algorithm to compute \( g^{ab} \)
given \( g^a \) and \( g^b \), otherwise, the communication is insecure.</p>
<h2 id="general-model"><a class="header" href="#general-model">General Model</a></h2>
<p><img src="DH-general.png" alt="DH-general" title="DH-general" /></p>
<p>From the above two examples of <em>Diffie-Hellman</em>,
we can find its general model.
The general model is shown on above figure.</p>
<p>To make sure the communication is secure,
function \( f \) must be one-way function
and there must be no efficient method to compute
the \( Secret_A, Secret_B \) given \( A, B \).</p>
<h3 id="the-standard-dh-implementation"><a class="header" href="#the-standard-dh-implementation">The standard DH implementation</a></h3>
<p>We demostrate the original implementation of <em>Diffie-Hellman</em>
in the general model below.</p>
<h4 id="the-hypothesis-and-the-function-operation"><a class="header" href="#the-hypothesis-and-the-function-operation">The Hypothesis and the Function Operation</a></h4>
<p>Hypothesis \( h \) is the group geneator \( g \),
and the function \( f, F \) are defined:</p>
<p>$$
f(x,y) = F(x,y) = x^y \mod p
$$</p>
<h4 id="alice"><a class="header" href="#alice">Alice</a></h4>
<p>Alice first randomly choose a secret number \( a \), \( a \in [1, p) \),
where \( p \) is the order of the group.
Next, Alice will compute a public key \( A \) and send it to Bob.
Then Alice will receive Bob's public key \( B \) and
then use it with secret number \( a \) to derive the shared key \( Secret_A \).
(For those who are not familiar with the following operations,
please read <a href="../modular_arithmetic.html" title="Modular Arithmetic">modular arithmetic</a> in the appendix first.)</p>
<p>\begin{aligned}
A =&amp; f(h,a) \\
=&amp; f(g,a) = g^a \mod p \\
\\
Secret_A =&amp; F(B,a) = B^a \mod p \\
=&amp; (f(h,b))^a \mod p \\
=&amp; (f(g,b))^a \mod p \\
=&amp; (g^b \mod p)^a \mod p \\
=&amp; g^{ab} \mod p
\end{aligned}</p>
<h4 id="bob"><a class="header" href="#bob">Bob</a></h4>
<p>Similarly, Bob first randomly choose a secret number \( b \), \( b \in [1, p) \),
where \( p \) is the order of the group.
Next, Bob will compute a public key \( B \) and send it to Alice.
Then Bob will receive Alice's public key \( A \) and
then use it with secret number \( b \) to derive the shared key \( Secret_B \).</p>
<p>\begin{aligned}
B =&amp; f(h,b) \\
=&amp; f(g,b) = g^b \mod p \\
\\
Secret_B =&amp; F(A,b) = A^b \mod p \\
=&amp; (f(h,a))^b \mod p \\
=&amp; (f(g,a))^b \mod p \\
=&amp; (g^a \mod p)^b \mod p \\
=&amp; g^{ab} \mod p
\end{aligned}</p>
<h3 id="for-color-calculation"><a class="header" href="#for-color-calculation">For Color Calculation</a></h3>
<p><img src="DH-color-calculation.png" alt="DH-color-calculation" title="DH-color-calculation" /></p>
<h4 id="color-code"><a class="header" href="#color-code">Color Code</a></h4>
<p>All of the color are mixed by red, green and blue lights.
They all can be coded in a RGB set \( (r, g, b) \),
where \( r \) is for red light, \( g \) is for green light, \( b \) is for blue light.</p>
<h5 id="operations"><a class="header" href="#operations">Operations</a></h5>
<p>The operations of color code are defined:</p>
<ol>
<li>\( k(r, g, b) = (kr, kg, kb) \), where \( k \) is a constant.</li>
<li>\( (p, q, r) \square (l, m, n) = (p \square l, q \square m, r \square n) \),
where \( \square \) can be any operator like \( +, -, \cdot, / \).</li>
</ol>
<h4 id="color-mixing"><a class="header" href="#color-mixing">Color Mixing</a></h4>
<p>Suppose we have n colors: \( C_1, C_2, ...,C_n \),
where \( C_1 = (R_1, G_1, B_1), C_2 = (R_2, G_2, B_2), ...,
C_n = (R_n, G_n, B_n) \).
The <strong>mixing color</strong> for these n one is
\( C_{mixing} = (C_1 + C_2 + ... + C_n)/n
= (\frac{R_1 + R_2 + ... + R_n}{n},
\frac{G_1 + G_2 + ... + G_n}{n},
\frac{B_1 + B_2 + ... + B_n}{n}) \)</p>
<h4 id="the-hypothesis-and-the-function-operation-1"><a class="header" href="#the-hypothesis-and-the-function-operation-1">The Hypothesis and the Function Operation</a></h4>
<p>Hypothesis \( h \) is the group geneator \( g \),
and the function \( f, F \) are defined:</p>
<p>\begin{aligned}
f(X,Y) =&amp; \frac{X}{2} + \frac{Y}{2} \\
=&amp; \frac{(R_x, G_x, B_x)}{2} + \frac{(R_y, G_y, B_y)}{2} \\
=&amp; (\frac{R_x + R_y}{2},
\frac{G_x + G_y}{2},
\frac{B_x + B_y}{2}) \\
\\
F(X,Y) =&amp; \frac{2X}{3} + \frac{Y}{3} \\
=&amp; \frac{(2R_x, 2G_x, 2B_x)}{3} + \frac{(R_y, G_y, B_y)}{3} \\
=&amp; (\frac{2R_x + R_y}{3},
\frac{2G_x + G_y}{3},
\frac{2B_x + B_y}{3})
\end{aligned}</p>
<p>$$
\text{, where } X = (R_x, G_x, B_x), Y=(R_y, G_y, B_y) \text{ are both RGB-color sets.}
$$</p>
<h4 id="alice-1"><a class="header" href="#alice-1">Alice</a></h4>
<p>Randomly choose a secret color \( a = (R_a, G_a, B_a) \).</p>
<p>The mixing color \( A \), \( A = (R_A, G_A, B_A) = f(h, a) \), will be sent to Bob,
and Alice will receive a mixing color \( B \) from Bob.
Then \( Secret_A \) can be derived by \( B \) and \( a \).</p>
<p>\begin{aligned}
A =&amp; (R_A, G_A, B_A) \\
=&amp; f(h, a) \\
=&amp; (\frac{R_i + R_a}{2},
\frac{G_i + G_a}{2},
\frac{B_i + B_a}{2})
\\
Secret_A =&amp; F(B, a) \\
=&amp; (\frac{2R_B + R_a}{3},
\frac{2G_B + G_a}{3},
\frac{2B_B + B_a}{3}) \\
=&amp; (\frac{2(\frac{R_i + R_b}{2}) + R_a}{3},
\frac{2(\frac{G_i + G_b}{2}) + G_a}{3},
\frac{2(\frac{B_i + B_b}{2}) + B_a}{3}) \\
=&amp; (\frac{R_i + R_a + R_b}{3},
\frac{G_i + G_a + G_b}{3},
\frac{B_i + B_a + B_b}{3})
\end{aligned}</p>
<h4 id="bob-1"><a class="header" href="#bob-1">Bob</a></h4>
<p>Randomly choose a secret color \( b = (R_b, G_b, B_b) \)</p>
<p>The mixing color \( B \), \( B = (R_B, G_B, B_B) = f(h, b) \), will be sent to Alice,
and Bob will receive a mixing color \( A \) from Alice.
Then \( Secret_B \) can be derived by \( A \) and \( b \).</p>
<p>\begin{aligned}
B =&amp; (R_B, G_B, B_B) \\
=&amp; f(h, b) \\
=&amp; (\frac{R_i + R_b}{2},
\frac{G_i + G_b}{2},
\frac{B_i + B_b}{2})
\\
Secret_B =&amp; F(A, b) \\
=&amp; (\frac{2R_A + R_b}{3},
\frac{2G_A + G_b}{3},
\frac{2B_A + B_b}{3}) \\
=&amp; (\frac{2(\frac{R_i + R_a}{2}) + R_b}{3},
\frac{2(\frac{G_i + G_a}{2}) + G_b}{3},
\frac{2(\frac{B_i + B_a}{2}) + B_b}{3}) \\
=&amp; (\frac{R_i + R_a + R_b}{3},
\frac{G_i + G_a + G_b}{3},
\frac{B_i + B_a + B_b}{3})
\end{aligned}</p>
<h2 id="real-world-usage"><a class="header" href="#real-world-usage">Real World Usage</a></h2>
<p>The symmetric secret key \( Secret_A, Secret_B \) is almost never used
as the cryptographic key directly since it may have some weak bits.
One possible solution is to use its <strong>hash value</strong> instead
to overcome this weakness.</p>
<h2 id="weak-of-dh-no-authentication"><a class="header" href="#weak-of-dh-no-authentication">Weak of DH: No Authentication</a></h2>
<p><img src="eve-active-attacker.png" alt="eve-active-attacker" title="Active Attacker" /></p>
<p><em>Diffie-Hellman</em> protocol has an obvious weak:
It has no <strong>authentication</strong> mechanism.
<strong>Neither side of the exchange is authenticated</strong>.
Alice and Bob indeed can generate a shared secret key,
but Alice can't distinguish whether or not Bob is the real one,
and Bob can't know whether or not the one he is talking to is Alice.</p>
<p>This weak give Eve a chance to cheat them.
First, Eve can intercepts the public key \( A \) from Alice for Bob
and substitutes it with Eve's own public key \( E \) to Bob.
After Bob send back his public key \( B \), Eve will finally get a
shared secret key paired with Bob.</p>
<p>Next, Eve will act as Bob and send her another public key \( E' \) to Alice.
Then Eve can get a shared secret key paired with Alice.</p>
<p>That is, Eve can generate shared secret keys with them both</p>
<ul>
<li>Secret<sub>Eve</sub>,
that is same as the one Bob has: Secret<sub>Bob</sub></li>
<li>Secret'<sub>Eve</sub>,
that is same as the one Alice has: Secret<sub>Alice</sub></li>
</ul>
<p>Thus, Eve can build secure channels with them each other
and act as a bridge to pass the messages between Alice and Bob.
Alice still can talk to Bob through Eve, and vice versa.
However, Eve can know anything that Bob talks to Alice,
and all the Alice's messages to Bob
by decrypting the received messages from Alice or Bob.
Before re-encrypting with the appropriate key
and transmitting them to the other party,
Eve even can tamper the messages.</p>
<p>This is really dangerous.
Using <strong>digital signatures</strong> is a possible solution
to avoid this active attack,
but it requires a public key infrastructure(PKI)
to do the authentication.</p>
<h2 id="one-way-function"><a class="header" href="#one-way-function">One-way Function</a></h2>
<p>The trapdoor function, or the one-way function,
is the base of the network security today.
Please read <a href="../trapdoor_function.html" title="Trapdoor Function">trapdoor function</a>
in appendix to get more detail.</p>
<h2 id="operation-with-more-than-two-parties"><a class="header" href="#operation-with-more-than-two-parties">Operation with More than Two Parties</a></h2>
<p>The Diffie–Hellman protocol can work on more than two parties.
Please read <a href="dh_multiple_parties.html" title="Diffie–Hellman with multiple parties">Diffie–Hellman in multiple parties</a>
in appendix to get more detail.</p>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=YEBfamv-_do" title="Public key cryptography - Diffie-Hellman Key Exchange">General introduction of Diffie-Hellman Key Exchange</a></li>
<li><a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange" title="Diffie–Hellman key exchange">Wiki: Diffie–Hellman key exchange</a></li>
<li><a href="http://trycolors.com/" title="Online Color Mixing tool">TryColors: Online Color Mixing tool</a></li>
<li><a href="http://www.htmlcsscolor.com/" title="Get Color Info">htmlcsscolor: Get Color Name and Info</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../appendix/trapdoor_function.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../appendix/dh/dh_multiple_parties.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../appendix/trapdoor_function.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../appendix/dh/dh_multiple_parties.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
